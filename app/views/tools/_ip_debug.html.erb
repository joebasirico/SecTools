<!-- IP Debug Information (Remove this in production) -->
<details class="border rounded-lg p-4 mt-4" style="background-color: var(--color-bg-secondary); border-color: var(--color-warning);">
  <summary class="cursor-pointer font-mono text-sm font-bold" style="color: var(--color-warning);">
    üîç DEBUG: IP Detection Details
  </summary>
  <div class="mt-4 space-y-2 font-mono text-xs">
    <div class="border-b pb-2" style="border-color: var(--color-border);">
      <strong>Detected IP:</strong> <%= @user_ip_address %>
    </div>

    <div class="border-b pb-2" style="border-color: var(--color-border);">
      <strong>request.remote_ip:</strong> <%= request.remote_ip %>
    </div>

    <div class="border-b pb-2" style="border-color: var(--color-border);">
      <strong>X-Forwarded-For:</strong> <%= request.headers['X-Forwarded-For'] || 'Not set' %>
    </div>

    <div class="border-b pb-2" style="border-color: var(--color-border);">
      <strong>X-Real-IP:</strong> <%= request.headers['X-Real-IP'] || 'Not set' %>
    </div>

    <div class="border-b pb-2" style="border-color: var(--color-border);">
      <strong>CF-Connecting-IP (Cloudflare):</strong> <%= request.headers['CF-Connecting-IP'] || 'Not set' %>
    </div>

    <div class="border-b pb-2" style="border-color: var(--color-border);">
      <strong>X-Client-IP:</strong> <%= request.headers['X-Client-IP'] || 'Not set' %>
    </div>

    <div class="border-b pb-2" style="border-color: var(--color-border);">
      <strong>Fastly-Client-IP:</strong> <%= request.headers['Fastly-Client-IP'] || 'Not set' %>
    </div>

    <div class="mt-3 p-2 rounded" style="background-color: rgba(234, 179, 8, 0.1);">
      <strong>All Request Headers (filtered):</strong>
      <div class="mt-2 space-y-1" style="max-height: 200px; overflow-y: auto;">
        <% request.headers.env.select { |k,v| k.start_with?('HTTP_') || k.include?('REMOTE') || k.include?('FORWARD') }.sort.each do |key, value| %>
          <div class="text-xs">
            <span style="color: var(--color-primary);"><%= key %>:</span>
            <span style="color: var(--color-text-secondary);"><%= value %></span>
          </div>
        <% end %>
      </div>
    </div>

    <div class="mt-3 p-2 rounded text-xs" style="background-color: rgba(34, 197, 94, 0.1); color: var(--color-success);">
      <strong>üí° Tip:</strong> If your IP is wrong, check your Nginx/Apache configuration to ensure it's passing the X-Forwarded-For header correctly.
    </div>
  </div>
</details>
