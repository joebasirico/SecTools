# Hardcoded Secrets Detection Rules
# These patterns detect secrets and credentials in source code

name: Hardcoded Secrets
severity: CRITICAL
description: Detects hardcoded passwords, API keys, and other sensitive credentials

patterns:
  - description: Hardcoded password
    languages: [ruby, python, javascript, typescript, php, java]
    regex: '(password|passwd|pwd)\s*=\s*[''"][^''"]{3,}[''"]'
    example: 'password = "MyP@ssw0rd"'
    recommendation: Use environment variables or secure credential management

  - description: Hardcoded API key
    languages: [ruby, python, javascript, typescript, php, java]
    regex: '(api_key|apikey|api_secret|api_token)\s*=\s*[''"][^''"]{8,}[''"]'
    example: 'api_key = "sk_live_abc123xyz"'
    recommendation: Use environment variables or secure vault systems

  - description: Hardcoded secret key
    languages: [ruby, python, javascript, typescript, php, java]
    regex: '(secret_key|secret_token|secret)\s*=\s*[''"][^''"]{8,}[''"]'
    example: 'secret_key = "my-super-secret-key-12345"'
    recommendation: Use environment variables or Rails credentials

  - description: Hardcoded private key
    languages: [ruby, python, javascript, typescript, php, java]
    regex: '(private_key|privatekey)\s*=\s*[''"][^''"]{8,}[''"]'
    example: 'private_key = "-----BEGIN RSA PRIVATE KEY-----"'
    recommendation: Store keys in secure files outside repository

  - description: Private key in source code
    languages: [ruby, python, javascript, typescript, php, java]
    regex: 'BEGIN (RSA|DSA|EC|OPENSSH) PRIVATE KEY'
    example: '-----BEGIN RSA PRIVATE KEY-----'
    recommendation: Never commit private keys - use key management systems

  - description: AWS Access Key
    languages: [ruby, python, javascript, typescript, php, java]
    regex: 'AKIA[0-9A-Z]{16}'
    example: 'aws_access_key = "AKIAIOSFODNN7EXAMPLE"'
    recommendation: Use AWS IAM roles or AWS Secrets Manager

  - description: Database connection string with password
    languages: [ruby, python, javascript, typescript, php, java]
    regex: '(mysql|postgres|mongodb):\/\/[^:]+:[^@]+@'
    example: 'db_url = "postgres://user:pass123@localhost/db"'
    recommendation: Use environment variables for database credentials

  - description: JWT secret
    languages: [ruby, python, javascript, typescript, php, java]
    regex: '(jwt_secret|jwt_key)\s*=\s*[''"][^''"]{8,}[''"]'
    example: 'jwt_secret = "my-jwt-signing-secret"'
    recommendation: Use environment variables for JWT secrets

  - description: Slack webhook URL
    languages: [ruby, python, javascript, typescript, php, java]
    regex: 'https:\/\/hooks\.slack\.com\/services\/T[A-Z0-9]+\/B[A-Z0-9]+\/[A-Za-z0-9]+'
    example: 'webhook = "https://hooks.slack.com/services/T00/B00/xxx"'
    recommendation: Store webhook URLs in environment variables

  - description: Generic token pattern
    languages: [ruby, python, javascript, typescript, php, java]
    regex: '(token|auth_token|access_token)\s*=\s*[''"][A-Za-z0-9_\-]{20,}[''"]'
    example: 'token = "ghp_xxxxxxxxxxxxxxxxxxxxxxxxxxxx"'
    recommendation: Use secure credential storage, never hardcode tokens

references:
  - https://owasp.org/www-community/vulnerabilities/Use_of_hard-coded_password
  - https://github.com/awslabs/git-secrets
  - https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
